# File: AP-14.md

**REF-ID:** AP-14  
**Version:** 1.0.0  
**Category:** Anti-Patterns  
**Type:** Error Handling  
**Severity:** ðŸŸ  High  
**Status:** Active

---

## SUMMARY

Using bare `except:` clauses without specifying exception types. This catches ALL exceptions including system exits, masking real errors.

---

## THE ANTI-PATTERN

```python
# âŒ BARE EXCEPT
try:
    result = risky_operation()
except:  # Catches EVERYTHING!
    gateway.log_error("Something failed")
    return None
```

**Catches:**
- KeyboardInterrupt
- SystemExit
- MemoryError
- ALL exceptions

---

## WHAT TO DO INSTEAD

```python
# âœ… SPECIFIC EXCEPTIONS
try:
    result = risky_operation()
except ValueError as e:
    gateway.log_error(f"Invalid value: {e}")
    return None
except KeyError as e:
    gateway.log_error(f"Missing key: {e}")
    return None
except Exception as e:
    gateway.log_error(f"Unexpected error: {e}")
    raise
```

---

## WHY IT'S WRONG

1. **Masks System Signals** - Catches KeyboardInterrupt, SystemExit
2. **Hides Real Errors** - Generic handling loses context
3. **Hard to Debug** - "Something failed" tells nothing
4. **Violates Fail-Fast** - Errors should surface

---

## EXCEPTION HIERARCHY

```python
BaseException
â"œâ"€â"€ SystemExit
â"œâ"€â"€ KeyboardInterrupt
â"œâ"€â"€ GeneratorExit
â""â"€â"€ Exception  # Catch this level or lower
    â"œâ"€â"€ StopIteration
    â"œâ"€â"€ ArithmeticError
    â"œâ"€â"€ AssertionError
    â"œâ"€â"€ AttributeError
    â"œâ"€â"€ BufferError
    â"œâ"€â"€ EOFError
    â"œâ"€â"€ ImportError
    â"œâ"€â"€ LookupError (KeyError, IndexError)
    â"œâ"€â"€ NameError
    â"œâ"€â"€ OSError (IOError)
    â"œâ"€â"€ RuntimeError
    â"œâ"€â"€ TypeError
    â""â"€â"€ ValueError
```

**Never catch above Exception level!**

---

## DETECTION

```bash
# Find bare except
grep -r "except:" src/ | grep -v "except Exception"
grep -r "except  :" src/  # With space

# Should return ZERO results
```

---

## RELATED

- **AP-15** - Swallowing Exceptions
- **AP-16** - No Error Context

---

**Keywords:** bare except, exception handling, error masking

---

**END OF AP-14**

---

# File: AP-15.md

**REF-ID:** AP-15  
**Version:** 1.0.0  
**Category:** Anti-Patterns  
**Type:** Error Handling  
**Severity:** ðŸŸ  High  
**Status:** Active

---

## SUMMARY

Catching exceptions and doing nothing with them (swallowing errors). This hides failures and makes debugging impossible.

---

## THE ANTI-PATTERN

```python
# âŒ SWALLOWING EXCEPTIONS
try:
    critical_operation()
except Exception:
    pass  # Silent failure!

# Or worse:
try:
    important_check()
except Exception:
    return True  # Pretend success!
```

---

## WHAT TO DO INSTEAD

```python
# âœ… LOG AND HANDLE
try:
    critical_operation()
except ValueError as e:
    gateway.log_error(f"Operation failed: {e}")
    return default_value
except Exception as e:
    gateway.log_error(f"Unexpected error: {e}")
    raise  # Re-raise if can't handle
```

---

## WHY IT'S WRONG

1. **Silent Failures** - Errors disappear
2. **Impossible to Debug** - No trace
3. **False Success** - System thinks it worked
4. **Data Corruption** - Partial operations

---

## WHEN TO SUPPRESS

**Rare Valid Cases:**
```python
# âœ… Documented suppression
try:
    optional_metric()
except Exception as e:
    # Explicitly ignore - metrics are optional
    # Logged at debug level for troubleshooting
    gateway.log_debug(f"Optional metric failed: {e}")
    pass  # Intentionally suppressed
```

---

## RELATED

- **AP-14** - Bare Except
- **AP-16** - No Error Context

---

**Keywords:** swallowing exceptions, silent failures, error handling

---

**END OF AP-15**

---

# File: AP-16.md

**REF-ID:** AP-16  
**Version:** 1.0.0  
**Category:** Anti-Patterns  
**Type:** Error Handling  
**Severity:** ðŸŸ¡ Medium  
**Status:** Active

---

## SUMMARY

Raising new exceptions without preserving original context. Loses stack trace and makes debugging harder.

---

## THE ANTI-PATTERN

```python
# âŒ LOSING CONTEXT
try:
    process_data(data)
except ValueError:
    raise RuntimeError("Processing failed")
    # Lost original ValueError and stack!
```

---

## WHAT TO DO INSTEAD

```python
# âœ… PRESERVE CONTEXT
try:
    process_data(data)
except ValueError as e:
    raise RuntimeError("Processing failed") from e
    # Preserves original exception

# Or just add context:
except ValueError as e:
    raise ValueError(f"Processing failed for {data}: {e}") from e
```

---

## PYTHON 3 CHAINING

```python
# `from e` explicitly chains exceptions
try:
    operation()
except OriginalError as e:
    raise NewError("Context") from e
```

**Result:**
```
NewError: Context
  The above exception was the direct cause of:
OriginalError: Original message
  (full stack trace)
```

---

## RELATED

- **AP-14** - Bare Except
- **AP-15** - Swallowing Exceptions

---

**Keywords:** exception chaining, error context, stack trace

---

**END OF AP-16**

---

# File: ErrorHandling-Index.md

**Category:** Anti-Patterns  
**Topic:** Error Handling  
**Items:** 3  
**Version:** 1.0.0

---

## FILES

### AP-14: Bare Except Clauses
- **Severity:** ðŸŸ  High
- **Problem:** `except:` catches everything including system signals
- **Solution:** Use specific exception types

### AP-15: Swallowing Exceptions
- **Severity:** ðŸŸ  High
- **Problem:** `except: pass` hides failures
- **Solution:** Log and handle appropriately

### AP-16: No Error Context
- **Severity:** ðŸŸ¡ Medium
- **Problem:** Raising new exceptions loses original context
- **Solution:** Use `raise ... from e` for chaining

---

**Common Theme:** Proper error handling preserves information and enables debugging.

---

**Keywords:** exception handling, errors, debugging

**END OF INDEX**

---

# File: AP-17.md

**REF-ID:** AP-17  
**Version:** 1.0.0  
**Category:** Anti-Patterns  
**Type:** Security  
**Severity:** ðŸ"´ Critical  
**Status:** Active

---

## SUMMARY

Hardcoding secrets (API keys, passwords, tokens) in source code. Major security vulnerability exposing credentials.

---

## THE ANTI-PATTERN

```python
# âŒ HARDCODED SECRETS
API_KEY = "sk-abc123def456"
DB_PASSWORD = "MySecretPassword123"
TOKEN = "ghp_xxxxxxxxxxxxxxxxxxxx"

def connect():
    return requests.get(url, headers={"Authorization": f"Bearer {API_KEY}"})
```

---

## WHAT TO DO INSTEAD

```python
# âœ… USE GATEWAY CONFIG
def connect():
    api_key = gateway.config_get("api_key")
    return requests.get(url, headers={"Authorization": f"Bearer {api_key}"})
```

---

## SECRET STORAGE

**Use AWS Systems Manager Parameter Store:**
- Encrypted at rest
- Access controlled by IAM
- Audit trail of access
- Version history

**Via Gateway:**
```python
# Stored in SSM: /myapp/api_key
secret = gateway.config_get("api_key")
```

---

## DETECTION

```bash
# Find potential secrets
grep -r "API_KEY\s*=" src/
grep -r "PASSWORD\s*=" src/
grep -r "TOKEN\s*=" src/
grep -r "SECRET\s*=" src/
```

---

## RELATED

- **AP-18** - Logging Sensitive Data
- **DEC-12** - Multi-Tier Configuration

---

**Keywords:** secrets, API keys, passwords, security, SSM

---

**END OF AP-17**

---

# File: AP-18.md

**REF-ID:** AP-18  
**Version:** 1.0.0  
**Category:** Anti-Patterns  
**Type:** Security  
**Severity:** ðŸ"´ Critical  
**Status:** Active

---

## SUMMARY

Logging sensitive data (passwords, tokens, PII) that should be redacted. Creates security and compliance risks.

---

## THE ANTI-PATTERN

```python
# âŒ LOGGING SENSITIVE DATA
gateway.log_info(f"User login: {username}, password: {password}")
gateway.log_debug(f"API request: {api_key}")
gateway.log_info(f"Processing: {user_email}, SSN: {ssn}")
```

---

## WHAT TO DO INSTEAD

```python
# âœ… REDACT SENSITIVE DATA
gateway.log_info(f"User login: {username}, password: [REDACTED]")
gateway.log_debug(f"API request: [KEY_REDACTED]")
gateway.log_info(f"Processing: {redact_email(user_email)}, SSN: [REDACTED]")
```

---

## SENSITIVE DATA

**Never Log:**
- Passwords
- API keys / tokens
- Credit card numbers
- SSNs
- Email addresses (PII)
- Phone numbers (PII)
- IP addresses (PII in EU)
- Any personally identifiable information

---

## REDACTION HELPERS

```python
def redact_email(email):
    """user@domain.com â†' u***@domain.com"""
    local, domain = email.split('@')
    return f"{local[0]}***@{domain}"

def redact_key(key):
    """sk-abc123 â†' sk-***123"""
    return f"{key[:3]}***{key[-3:]}"
```

---

## RELATED

- **AP-17** - Hardcoded Secrets

---

**Keywords:** logging, sensitive data, PII, redaction, security

---

**END OF AP-18**

---

# File: AP-19.md

**REF-ID:** AP-19  
**Version:** 1.0.0  
**Category:** Anti-Patterns  
**Type:** Security  
**Severity:** ðŸ"´ Critical  
**Status:** Active

---

## SUMMARY

Allowing sentinel objects (like _CacheMiss) to leak across module boundaries. Caused BUG-01 with 535ms performance penalty.

---

## THE ANTI-PATTERN

```python
# âŒ SENTINEL LEAKING
# In cache_core.py
_CacheMiss = object()

def get_value(key):
    if key not in _CACHE:
        return _CacheMiss  # Sentinel leaks out!
    return _CACHE[key]

# In router
result = gateway.cache_get(key)
if result is None:  # Wrong check!
    # Sentinel passes through as truthy value
    return result  # Returns _CacheMiss object! 535ms penalty
```

---

## WHAT TO DO INSTEAD

```python
# âœ… SANITIZE AT ROUTER
# In interface_cache.py
def cache_get(key, default=None):
    from cache_core import get_value, _CacheMiss
    result = get_value(key)
    if result is _CacheMiss:
        return default  # Sanitized!
    return result

# In router
result = gateway.cache_get(key)
if result is None:  # Correct check
    # Handle cache miss
```

---

## WHY IT'S CRITICAL

**BUG-01 Incident:**
- Sentinel object leaked to router
- Router didn't check for sentinel
- Serialization attempted on sentinel
- 535ms added to every request
- 100% of traffic affected

---

## THE FIX (DEC-05)

**Sentinel Sanitization Rule:**
1. Sentinels are private to module
2. Interface layer sanitizes
3. Router never sees sentinels
4. Use None or default values externally

---

## RELATED

- **BUG-01** - Sentinel Leak (535ms)
- **DEC-05** - Sentinel Sanitization
- **AP-10** - Mutable Defaults

---

**Keywords:** sentinel objects, _CacheMiss, object leaking, sanitization

---

**END OF AP-19**

---

# File: Security-Index.md

**Category:** Anti-Patterns  
**Topic:** Security  
**Items:** 3  
**Version:** 1.0.0

---

## FILES

### AP-17: Hardcoded Secrets
- **Severity:** ðŸ"´ Critical
- **Problem:** API keys, passwords in code
- **Solution:** Use gateway.config_get() + SSM

### AP-18: Logging Sensitive Data
- **Severity:** ðŸ"´ Critical
- **Problem:** Passwords, PII in logs
- **Solution:** Redact before logging

### AP-19: Sentinel Objects Crossing Boundaries
- **Severity:** ðŸ"´ Critical
- **Problem:** Internal sentinels leak out
- **Solution:** Sanitize at interface layer (DEC-05)
- **Impact:** BUG-01 (535ms penalty)

---

**Common Theme:** Keep internal implementation details internal. Sanitize at boundaries.

---

**Keywords:** security, secrets, PII, sentinel objects

**END OF INDEX**
