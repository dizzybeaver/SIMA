# File: AP-12.md

**REF-ID:** AP-12  
**Version:** 1.0.0  
**Category:** Anti-Patterns  
**Type:** Performance  
**Severity:** üü° Medium  
**Status:** Active

---

## SUMMARY

Optimizing code before measuring performance. Premature optimization adds complexity without proven benefit.

---

## THE ANTI-PATTERN

```python
# ‚ùå PREMATURE OPTIMIZATION
def process_items(items):
    # "This MUST be slow, let me optimize"
    # Adds caching without measuring
    cache = {}
    results = []
    for item in items:
        key = hash(item)
        if key in cache:
            results.append(cache[key])
        else:
            result = expensive_operation(item)
            cache[key] = result
            results.append(result)
    return results
```

---

## WHY IT'S WRONG

**Problems:**
1. **Added complexity** without proven need
2. **Harder to understand** the code
3. **Premature decisions** may optimize wrong thing
4. **Time wasted** on non-bottlenecks

**Donald Knuth:**
"Premature optimization is the root of all evil."

---

## WHAT TO DO INSTEAD

```python
# ‚úÖ MEASURE FIRST, OPTIMIZE LATER
def process_items(items):
    # Simple, clear implementation
    results = []
    for item in items:
        results.append(expensive_operation(item))
    return results

# IF profiling shows this is slow, THEN optimize
```

---

## THE OPTIMIZATION PROCESS

**1. Measure:**
```python
import time
start = time.perf_counter()
result = process_items(data)
elapsed = time.perf_counter() - start
print(f"Time: {elapsed:.3f}s")
```

**2. Profile:**
```bash
python -m cProfile -o profile.stats script.py
python -m pstats profile.stats
```

**3. Identify Bottleneck:**
- What function takes most time?
- Is it called frequently?
- Can it be optimized?

**4. Optimize Bottleneck:**
- Make targeted change
- Measure improvement
- Keep if significant

**5. Document:**
```python
# Optimized based on profiling (2025-10-30)
# Before: 5.2s, After: 0.8s (6.5x improvement)
```

---

## WHEN TO OPTIMIZE

**YES:**
- Measured bottleneck
- Significant impact
- Clear improvement
- Worth complexity

**NO:**
- No measurements
- Micro-optimization
- Adds complexity
- Unclear benefit

---

## RELATED

- **LESS-02** - Measure Don't Guess
- **AP-03** - Gateway Overhead (measured: negligible)

---

**Keywords:** premature optimization, profiling, performance, measurement

---

**END OF AP-12**
