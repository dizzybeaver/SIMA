# AP-07.md - Large Modules

**REF-ID:** AP-07  
**Version:** 1.0.0  
**Category:** Anti-Patterns  
**Topic:** Implementation  
**Priority:** 🟡 MEDIUM  
**Status:** Active  
**Created:** 2025-10-30  
**Last Updated:** 2025-10-30

---

## Summary

Creating modules exceeding recommended size limits (typically 400 lines for core modules, 200 for interfaces). Large modules indicate missing abstractions and become progressively harder to understand and maintain.

---

## Context

Modules grow organically as features are added. Each addition seems small, but cumulative size makes the module unwieldy. Large files signal that multiple concerns are mixed together.

**Problem:** Cognitive overload, hidden abstractions, maintenance burden, merge conflicts.

---

## Content

### The Anti-Pattern

```python
# ❌ LARGE MODULE - operations.py (800+ lines)
"""Everything related to data operations."""

# Data structures (200 lines)
class DataStore: ...
class DataCache: ...

# Core operations (150 lines)
def get_value(key): ...
def set_value(key, value): ...
def delete_value(key): ...

# Validation (100 lines)
def validate_key(key): ...
def validate_value(value): ...
def validate_operation(op): ...

# Statistics (150 lines)
def get_stats(): ...
def reset_stats(): ...
def export_stats(): ...

# Management (200 lines)
def clear_all(): ...
def warmup(): ...
def backup(): ...
def restore(): ...
# ... more functions
```

### Why This Is Wrong

**1. Cognitive Load Exceeded**
```
Human working memory: ~7 chunks of information
300 lines: Fits in mental model ✓
800 lines: Cannot hold in mind ✗

Result: Must constantly scroll and re-read
```

**2. Hidden Abstractions**
```python
# 800 lines suggests missing modules:
# operations.py should split into:
# - core_operations.py (get/set/delete)
# - validation.py (all validation)
# - statistics.py (stats collection)
# - management.py (admin operations)
```

**3. Maintenance Friction**
```python
# Small file (200 lines): Easy to refactor
# Large file (800 lines): Fear-based avoidance
# "It works, don't touch it!"
```

**4. Parallel Development Issues**
```python
# Multiple developers editing same 800-line file
# = Merge conflicts on every commit
```

### Size Guidelines

| Module Type | Max Lines | Typical Size | Rationale |
|-------------|-----------|--------------|-----------|
| Core modules | 400 | 200-300 | Complex logic requires space |
| Interface modules | 200 | 100-150 | Simple delegation |
| Gateway modules | 300 | 150-250 | Routing logic |
| Utility modules | 300 | 150-200 | Helper functions |

**Guideline rationale:**
- Core modules: More complex, need room for implementation
- Interfaces: Thin wrappers, should stay small
- Utilities: Focused helpers, moderate size

### Correct Approach

```python
# ✅ FOCUSED MODULES - Split by responsibility

# core_operations.py (280 lines) - Core CRUD
class DataStore: ...

def get_value(key): ...
def set_value(key, value): ...
def delete_value(key): ...

# validation.py (150 lines) - All validation
def validate_key(key): ...
def validate_value(value): ...
def validate_operation(op): ...

# statistics.py (120 lines) - Metrics and stats
def get_stats(): ...
def reset_stats(): ...
def export_stats(): ...

# management.py (180 lines) - Admin operations
def clear_all(): ...
def warmup(): ...
def backup(): ...
def restore(): ...
```

### Detection

```bash
# Find large files
find src -name "*.py" -exec wc -l {} \; | sort -rn | head -20

# Flag files exceeding limits
find src -name "*_core.py" -exec wc -l {} \; | awk '$1 > 400 {print}'
find src -name "interface_*.py" -exec wc -l {} \; | awk '$1 > 200 {print}'

# Generate size report
for file in src/**/*.py; do
    lines=$(wc -l < "$file")
    if [ $lines -gt 300 ]; then
        echo "$file: $lines lines (consider splitting)"
    fi
done
```

### Migration Strategy

**When module exceeds limit:**

1. **Analyze responsibilities** - Identify logical sections
2. **Extract related functions** - Group by cohesion
3. **Create new modules** - One responsibility per file
4. **Update imports** - Point to new locations
5. **Test thoroughly** - Ensure behavior unchanged
6. **Document split** - Explain new organization

**Example migration:**
```python
# Before: operations.py (800 lines)
# After:
# - core_operations.py (280 lines)
# - validation.py (150 lines)
# - statistics.py (120 lines)
# - management.py (180 lines)

# Update imports:
# from operations import get_value
# becomes:
# from core_operations import get_value
```

---

## Related Topics

- **AP-06**: God Objects - Similar problem at class level
- **AP-20**: God Functions - Similar problem at function level
- **ARCH-09**: Module Size Limits - Official size constraints
- **DEC-17**: Flat File Structure - Organization strategy

---

## Keywords

large modules, module size, code organization, maintainability, cognitive load, file size limits

---

## Version History

- **2025-10-30**: Created - Genericized guidelines, added detection scripts

---

**File:** `AP-07.md`  
**Lines:** ~175  
**End of Document**
