# AP-28.md - Not Reading Complete Files

**REF-ID:** AP-28  
**Version:** 1.0.0  
**Category:** Anti-Patterns  
**Topic:** Process  
**Priority:** üî¥ CRITICAL  
**Status:** Active  
**Created:** 2025-10-30  
**Last Updated:** 2025-10-30

---

## Summary

Reading only part of a file before making changes leads to incomplete understanding, broken code, lost context, and unintended side effects. Critical process failure that causes majority of implementation bugs.

---

## Context

When reviewing or modifying code, reading the first 50-100 lines seems sufficient. But critical context, dependencies, and edge cases often live further in the file, leading to broken changes.

**Problem:** Incomplete understanding, broken code, duplicate functionality, lost dependencies, cascade failures.

---

## Content

### The Anti-Pattern

```
# ‚ùå PARTIAL READING

Developer: "I'll update cache_operations.py"
[Reads lines 1-50 only]
[Makes changes based on partial understanding]
[Breaks code in lines 100-200]

# Consequences:
# - Missed: Helper function at line 150
# - Missed: Global state at line 80
# - Missed: Critical comment at line 120
# - Missed: Related functionality at line 180
# - Result: Broken code, duplicate functions
```

### Why This Is Critical

**1. Missed Dependencies**
```python
# File: data_processor.py (300 lines)

# Lines 1-50: Public API
def process_data(data):
    # Developer reads this
    result = _transform(data)
    return result

# Line 150: Helper function (not seen!)
def _transform(data):
    # Uses global cache
    return cache.get_or_compute(data)

# Line 80: Global state (not seen!)
cache = LRUCache(max_size=1000)

# Developer's change:
def process_data(data):
    # Added validation
    validate(data)  # Good
    result = transform(data)  # Typo: transform not _transform!
    return result

# Result: NameError - transform doesn't exist
# Cause: Didn't see _transform at line 150
```

**2. Duplicate Functionality**
```python
# File: utilities.py (400 lines)

# Lines 1-80: Developer reads this
def format_date(date):
    return date.strftime("%Y-%m-%d")

# Line 250: Existing function (not seen!)
def format_timestamp(timestamp):
    # Already formats dates!
    return timestamp.strftime("%Y-%m-%d %H:%M:%S")

# Developer adds:
def format_datetime(dt):  # Duplicate!
    return dt.strftime("%Y-%m-%d %H:%M:%S")

# Result: Two functions doing same thing
```

**3. Lost Context**
```python
# File: api_client.py (250 lines)

# Lines 1-50: Developer reads this
def make_request(url):
    response = requests.get(url)
    return response.json()

# Line 180: Critical context (not seen!)
# IMPORTANT: All requests must include auth header
# IMPORTANT: Retry on 429 (rate limit)
# IMPORTANT: Cache responses for 5 minutes
# See: docs/api-guidelines.md

# Developer's change:
def make_request(url, method="GET"):
    # Added method parameter - good!
    if method == "GET":
        response = requests.get(url)
    else:
        response = requests.post(url)
    return response.json()

# Result: Lost auth, retry logic, caching
# Cause: Didn't read implementation details
```

**4. Broken Edge Cases**
```python
# File: validator.py (200 lines)

# Lines 1-60: Developer reads this
def validate_email(email):
    if "@" in email:
        return True
    return False

# Line 140: Edge case handling (not seen!)
# Note: Also handle plus addressing (user+tag@domain.com)
# Note: Reject temporary email domains
# Note: Validate domain has MX record

# Developer "improves":
def validate_email(email):
    # Added regex validation
    pattern = r'^[a-zA-Z0-9]+@[a-zA-Z0-9]+\.[a-zA-Z]+$'
    return re.match(pattern, email) is not None

# Result: Breaks plus addressing, removes checks
# Cause: Didn't see edge case handling
```

### Correct Approach

```
# ‚úÖ READ COMPLETE FILE

Developer: "I'll update cache_operations.py"

[Fetch COMPLETE file]
[Read ALL 280 lines]
[Understand full context:]
- Lines 1-50: Public API
- Lines 51-100: Internal helpers
- Lines 101-150: Error handling
- Lines 151-200: Cache management
- Lines 201-250: Statistics
- Lines 251-280: Cleanup

[Identify ALL dependencies]
[Note ALL global state]
[Understand ALL edge cases]

[Make informed changes]
[Verify changes don't break anything]
```

### Pre-Change Checklist

```markdown
## Before Modifying Any File

### Reading
- [ ] Fetched complete file
- [ ] Read all lines (not stopped early)
- [ ] Understood overall structure
- [ ] Identified all sections

### Dependencies
- [ ] Found all imports
- [ ] Found all global variables
- [ ] Found all helper functions
- [ ] Found all constants
- [ ] Mapped all cross-references

### Context
- [ ] Read all comments
- [ ] Read all docstrings
- [ ] Checked for TODOs/FIXMEs
- [ ] Understood design decisions
- [ ] Noted edge cases

### Validation
- [ ] Ready to make informed change
- [ ] Understand impact of change
- [ ] Know what tests to update
- [ ] Can explain rationale

**Time Required:** 3-10 minutes
**Bugs Prevented:** 80%+ of modification bugs
```

### Output Requirements

**When providing modified code:**
```markdown
## Complete File Output Rules

‚úÖ MUST include:
- ALL existing code
- ALL existing imports
- ALL existing functions
- ALL existing classes
- ALL existing constants
- Your modifications clearly marked

‚ùå NEVER provide:
- Partial snippets
- "Add this to line X"
- Fragments or excerpts
- Truncated code
- "... (rest unchanged)"

## Marking Changes
# ADDED: <description>
<new code>

# MODIFIED: <description>
<changed code>
```

### Detection

**Signs of partial reading:**
```python
# Import errors (missed imports)
# NameError (missed functions)
# Duplicate code (missed existing)
# Broken dependencies (missed relationships)
# Lost functionality (missed requirements)
```

**In code review:**
```
# Red flags:
- Added function that already exists
- Broke existing functionality
- Missing related changes
- Incomplete refactoring
- Lost edge case handling
```

### Real-World Examples

**Example 1: Cache system**
```python
# Partial read: Lines 1-80
# Missed: Line 150 has cache invalidation logic
# Change: Added new cache function
# Result: New function doesn't invalidate cache
# Impact: Stale data served to users
```

**Example 2: API client**
```python
# Partial read: Lines 1-60
# Missed: Line 200 has retry logic
# Change: Modified request function
# Result: Lost retry on failures
# Impact: Increased error rate
```

**Example 3: Validator**
```python
# Partial read: Lines 1-50
# Missed: Line 180 has sanitization
# Change: Added new validation rule
# Result: Validation without sanitization
# Impact: SQL injection vulnerability
```

### Tools and Automation

**Prevent partial changes:**
```python
# Git hook: Verify complete file understanding
# .git/hooks/pre-commit
#!/bin/bash

# For each modified file
for file in $(git diff --cached --name-only); do
    # Check if comprehensive comments exist
    if ! grep -q "COMPLETE FILE REVIEWED" "$file"; then
        echo "Error: $file not fully reviewed"
        exit 1
    fi
done
```

**IDE features:**
```
# Enable:
- Outline view (see full structure)
- Minimap (visual overview)
- Search in file (find all references)
- Fold all (see structure)
```

---

## Related Topics

- **LESS-01**: Read Complete Files - Lesson learned
- **LESS-15**: Verification Protocol - Includes complete reading
- **AP-27**: Skip Verification - Related process failure

---

## Keywords

complete files, partial reading, context, code comprehension, modification safety, dependencies

---

## Version History

- **2025-10-30**: Created - Added prevention strategies and real examples

---

**File:** `AP-28.md`  
**Lines:** ~200  
**End of Document**
